/*@autor jalduran 01-oct-2017 copyright*/function postAjax(e,t,n){var r="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){a.readyState>3&&200==a.status&&n(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(r),a}function postajaxvot(t,n,r,a,o,d,l){postAjax("http://"+t+n,{evento:a,nomtit:o,[r.name]:r.value},function(t){var n=document.getElementById("vtvotes"),l=[],s=[],c=0,m=0,u=str2DOMElement(t),p=0,g=0,b=new Array,f=document.getElementById("frmArea"),y=f.getElementsByTagName("tr")[1].getElementsByTagName("b"),x=f.getElementsByTagName("tr");for(e=2;e<x.length;e++){var v=x[e].getElementsByTagName("td").length;v>2&&(lt=v,b[p]=x[e].getElementsByTagName("font")[0].innerText,p++)}for(i=0;i<u.parentNode.childNodes.length;i++){var h=u.parentNode.childNodes[i].nodeName;if("TABLE"==h){if(u.parentNode.childNodes[i].getElementsByTagName("table").length>0)for(nn=2;nn<u.parentNode.childNodes[i].getElementsByTagName("table")[1].getElementsByTagName("td").length;nn++){s=u.parentNode.childNodes[i].getElementsByTagName("table")[1].getElementsByTagName("td")[nn].childNodes;for(ix=0;ix<s.length;ix++)s[ix].data&&(l[c]=s[ix].data.split(":")[1],c++)}else for(nn=0;nn<u.parentNode.childNodes[i].getElementsByTagName("td").length;nn++){s=u.parentNode.childNodes[i].getElementsByTagName("td")[nn].childNodes;for(ix=0;ix<s.length;ix++)s[ix].data&&(l[c]=s[ix].data.split(":")[1],c++)}var E=document.createElement("table");if(E.setAttribute("id","vt"+r.name),E.setAttribute("align","center"),E.setAttribute("border",""),E.setAttribute("cellspacing","2"),E.setAttribute("width","600"),E.setAttribute("class","result"),E.setAttribute("style","display:none;"),""==(h=getname(r.name,y,b,v)).partido||null==h.partido);else{m++;var A='<tbody><tr class="votr"><td bgcolor="'+d+'">'+o+" "+a+"</td>";A+="<td>Partido</td>",A+="<td>Tipo</td>",A+="</tr>";T=document.createElement("tr");for(ix=0;ix<l.length;ix++){var T=document.createElement("tr");A+="<tr><td>"+l[ix]+"</td>",A+="<td>"+h.partido+"</td>";var N="<td>"+l[ix]+"</td>";N+="<td>"+h.partido+"</td>",A+="<td>"+h.tipo+"</td>",N+="<td>"+h.tipo+"</td>",A+="</tr>",T.innerHTML=N,n.appendChild(T),g++}A+="</tbody>",E.innerHTML=A,document.body.appendChild(E)}}}})}function savexls(e){var t="<table border='2px'><tr bgcolor='#87AFC6'>",n=0;for(tab=document.getElementById("vt"+e),n=0;n<tab.rows.length;n++)t=t+tab.rows[n].innerHTML+"</tr>";t+="</table>",window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?(txtArea.document.open("txt/html","replace"),txtArea.document.write(t),txtArea.document.close(),txtArea.focus(),sa=txtArea.document.execCommand("SaveAs",!0,e)):sa=window.open("data:application/vnd.ms-excel,"+escape(t))}function getname(e,t,n,r){var a=new Array;a.partido="",a.tipo="",a.cn=0;var o=parseInt(e.match(/\[(.*?)\]/)[1]);for(f=2;f<=lt;f++)o>10*f&&o<10*f+11&&(a.partido=t[f].innerText,a.tipo=n[o-(10*f+1)],a.cn=f);return a}function sort(t){var n=new Array,r=document.getElementById("vtvotes").getElementsByTagName("tr");for(e=1;e<r.length;e++){var a=r[e].getElementsByTagName("td");n.push([a[0].innerText,a[1].innerText,a[2].innerText])}switch(t){case"p":n.sort(function(e,t){return e=e[1]+e[2]+e[0],t=t[1]+t[2]+t[0],e==t?0:e<t?-1:1});break;case"t":n.sort(function(e,t){return e=e[2]+e[1]+e[0],t=t[2]+t[1]+t[0],e==t?0:e<t?-1:1})}for(e=1;e<r.length;e++)(a=r[e].getElementsByTagName("td"))[0].innerText=n[e-1][0],a[1].innerText=n[e-1][1],a[2].innerText=n[e-1][2]}function fnExcelReport(){var t=document.createElement("table");t.setAttribute("id","vtvotes"),t.setAttribute("align","center"),t.setAttribute("border",""),t.setAttribute("width","610");var n=window.location.hostname,r=0,a=0,o=document.getElementsByTagName("form");o[0].setAttribute("id","frmArea");var d=document.getElementById("frmArea").getAttribute("action"),i=new Array,l=((f=document.getElementById("frmArea")).getElementsByTagName("tr")[1].getElementsByTagName("b"),f.getElementsByTagName("tr"));for(e=2;e<l.length;e++){var s=l[e].getElementsByTagName("td").length;s>2&&(lt=s,i[r]=l[e].getElementsByTagName("font")[0].innerText,r++)}var c=o[0].elements;for(e=0;e<c.length;e++){if("undefined"!==c[e].name)if(c[e].name.length){if("evento"==c[e].name){c[e].name;var m=c[e].value}if("nomtit"==c[e].name){c[e].name;var u=c[e].value}if("nomtit"!=c[e].name&&"evento"!=c[e].name&&" 0 "!=c[e].value){if(1==++a){var p="<tr><td>"+u+" "+m+"</td>";p+="<td>Partido</td>",p+="<td>Tipo</td>",p+="</tr>",t.innerHTML=p,document.body.appendChild(t)}var g="#"+((1<<24)*Math.random()|0).toString(16);c[e].style.backgroundColor=g,c[e].style.cursor="pointer",c[e].type="button",c[e].setAttribute("onclick",'savexls("'+c[e].name+'");'),postajaxvot(n,d,c[e],m,u,g,e)}}else c[e].style.backgroundColor="#ffbcbc";var b=document.getElementById("btnExport");b.setAttribute("onclick",""),b.setAttribute("style","display:none;")}var f=document.getElementById("txtArea"),y=document.createElement("button"),x=(document.createElement("button"),document.createElement("button")),v=document.createElement("button");y.setAttribute("onclick",'savexls("votes");'),x.setAttribute("onclick",'sort("p");'),v.setAttribute("onclick",'sort("t");'),y.setAttribute("style","padding:5px;cursor:pointer;"),x.setAttribute("style","padding:5px;cursor:pointer;"),v.setAttribute("style","padding:5px;cursor:pointer;");var h=document.createTextNode("Exportar Excel"),E=document.createTextNode("Ordenar por partido"),A=document.createTextNode("Ordenar por tipo");y.appendChild(h),x.appendChild(E),v.appendChild(A),f.appendChild(y),f.appendChild(x),f.appendChild(v)}var jq=document.createElement("script");jq.src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(jq),setTimeout(function(){jQuery.noConflict(),console.log("jQuery loaded")},1e3);var btn=document.createElement("button");btn.setAttribute("id","btnExport"),btn.setAttribute("onclick","fnExcelReport();"),btn.setAttribute("style","padding:5px;cursor:pointer;");var t=document.createTextNode("Procesa datos");btn.appendChild(t);var ifr=document.createElement("div");ifr.setAttribute("id","txtArea"),ifr.setAttribute("style","margin: 0 auto;border:solid 1px; blue; background-color:#e4e4e4;display:block;width:600px;height:120px;overflow:scroll;");var help="Presiona el boton procesar que generara la tabla y posteriormente Exportar en excel<br/>";help+="Una vez procesado podras dar click en algun elemento de totales en la tabla de votaciones para exportarlo<br/><br/>",ifr.innerHTML=help,ifr.appendChild(btn),document.body.appendChild(ifr);var str2DOMElement=function(e){var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),t.contentDocument.close();var n=t.contentDocument.body.firstChild;return document.body.removeChild(t),n};
