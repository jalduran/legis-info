function postAjax(e,t,n){var r="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){if(a.readyState>3&&200==a.status){contaj++;var e=new Date;document.getElementById("txtArea4").innerHTML="procesados: "+contaj+" Tiempo: "+returnDiffToText(e-start),n(a.responseText)}},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(r),a}function returnDiffToText(e){var t="";if((e=e/1e3)<60)t=e+" segundos";else{var n=Math.round(e%60);e=Math.floor(e/60);var r=Math.round(e%60);e=Math.floor(e/60);var a=Math.round(e%24),i=e=Math.floor(e/24);t=i>0?i+" dias, "+a+" horas, "+r+" minutos y "+n+" segundos":a>0?a+" horas, "+r+" minutos y "+n+" segundos":r+" minutos y "+n+" segundos"}return t}function Validaentradas(){var intLegislatura=document.forms[0].LEGISLATURA.selectedIndex,intCamara=document.forms[0].CAMARA.selectedIndex,intActor=document.forms[0].PRESENTADOR.selectedIndex,FECHA_INIC=document.MyForm.FECHA_INIC.value,FECHA_FIN=document.MyForm.FECHA_FIN.value;with(document.MyForm){if(0==intLegislatura)return alert("Selecciona una legislatura"),document.forms[0].LEGISLATURA.focus(),!1;if(0==intCamara)return alert("Selecciona una instancia"),document.forms[0].CAMARA.focus(),!1;if(0==intActor)return alert("Selecciona una opción de los presentadores"),document.forms[0].PRESENTADOR.focus(),!1;if(""==document.MyForm.FECHA_INIC.value&&""!=document.MyForm.FECHA_FIN.value)return alert("Debes incluir la fecha de inicio para poder realizar la búsqueda"),document.MyForm.FECHA_INIC.focus(),!1;if(ValidateDates("MyForm","FECHA_INIC","FECHA_FIN"))return intLegislatura=document.MyForm.LEGISLATURA.options[document.MyForm.LEGISLATURA.selectedIndex].value,!!ValidaFechasFormulario("MyForm","FECHA_INIC","FECHA_FIN",intLegislatura,"mensaje")}return!0}function savexlsdata(e){for(var t=window.setInterval("",5e3),n=1;n<t;n++)window.clearInterval(n);for(var t=window.setInterval("",2e3),n=1;n<t;n++)window.clearInterval(n);var r="",a="<tr>";for(j=0;j<e.length;j++){var a="<tr>",i=e[j];for(c=0;c<i.length;c++)a=a+"<td>"+i[c]+"</td>";r+=a+="</tr>"}var o=new Blob(['<meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><table border="1">'+r+"</table>"],{type:"data:application/vnd.ms-excel;charset=UTF-8"}),d=document.getElementById("filename").value;saveAs(o,"sil_"+d+".xls"),document.getElementById("txtArea3").innerHTML=parseInt(r.length/1e3)+" Kb";var e=new Array;cleanrock(),document.getElementById("rocket").setAttribute("style","text-align:center;color:#49ca4e;")}function getpdf(e){var t=e.length;for(exe=1;exe<t;exe++){var n=document.createElement("div");n.setAttribute("style","display: none;"),n.innerHTML=e[exe][2];var r=n.getElementsByTagName("a");if(r[0]){document.getElementById("txtArea3").innerHTML="reg "+exe;var a=r[0].innerText,i=r[0].getAttribute("onclick"),o="http://sil.gobernacion.gob.mx"+(i=(i=(i=(i=i.replace("window.open","")).replace("(","")).replace(")","")).replace('"',"")).split(",")[0];e[exe][2]=a,0!=e[exe][13]&&"0"!=e[exe][13]||(e=calltoobject(o,exe,e))}}return e}function calltoobject(e,t,n){var r=n[t][13];if(0==r||"0"==r)if("sin pdf"==r);else{var a=e.split("?")[1].split("&"),o=new Array;for(i=0;i<a.length;i++)o[a[i].split("=")[0]]=a[i].split("=")[1];postAjax(e,{SID:o.SID,Clave:o.Clave},function(e){var r=document.createElement("iframe");r.setAttribute("id","frameps"+els),r.style.display="none",document.body.appendChild(r),r.contentWindow.document.open(),r.contentWindow.document.write(e),r.contentWindow.document.close();var a=r.contentWindow.document.getElementsByTagName("table")[2].getElementsByTagName("tr");document.body.removeChild(r);var i=setTimeout(function(){var e=!0,r=a.length;for(det=0;det<r;det++){var o=a[det].getElementsByTagName("td");if(1==e){var d=o[0].innerHTML;e=!1,idn=d.substring(0,3)}else{switch(l=o[0].innerHTML,d){case"Objeto":var l=o[0].innerHTML.toString().replace(/(&nbsp;)/g,""),s=l.replace(/<br\s*[\/]?>/g,"");n[t][12]=s;break;case"Observaciones":var c=o[0].innerHTML.toString().replace(/(&nbsp;)/g,"").replace(/<br\s*[\/]?>/g,"");n[t][14]=c;break;case"Archivo Adjunto":var u=o[0].getElementsByTagName("a")[0];n[t][13]=u?o[0].getElementsByTagName("a")[0].href:"sin pdf"}e=!0}}if(0!=n[t][13]&&"0"!=n[t][13])return clearTimeout(i),n},2e3)})}return n}function calltoajax(e){if(e){e.split("?")[0];var t=e.split("?")[1].split("&"),n=t[0].split("=")[1],r=t[1].split("=")[1],a=t[2].split("=")[1],o=t[3].split("=")[1],d=t[4].split("=")[1],l=t[5].split("=")[1],s=t[6].split("=")[1],c=t.join("-");c.replace("=","_");var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("id","filename"),u.setAttribute("name","filename"),u.setAttribute("value",c),document.body.appendChild(u)}var m=setInterval(function(){postAjax(e,{Clave:n,Legislatura:r,Camara:a,Actor:o,FechI:d,FechF:l,Reg:s},function(e){var t=document.createElement("iframe");t.setAttribute("style","width:100%;height:350px"),t.style.display="none",t.setAttribute("id","rframex"),document.body.appendChild(t),t.contentWindow.document,t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close();var n=t.contentWindow.document;if((links=n.getElementsByTagName("a")).length>0){clearInterval(m);var r=document.createElement("input");r.setAttribute("id","sql"),r.setAttribute("name","sql"),r.setAttribute("type","hidden"),r.setAttribute("value",links[0].href),document.body.appendChild(r);var a=setTimeout(function(){var e=document.getElementById("sql");if(e){clearTimeout(a);var t=document.getElementsByTagName("iframe");if(t)for(inn=1;inn<t.length;inn++)t[inn].remove();(t=document.getElementById("rframex"))&&t.remove();var n=e.value.split("?"),r=n[1].split("&"),o=new Array;for(i=0;i<r.length;i++)o[r[i].split("=")[0]]=r[i].split("=")[1];var d=o.SID,l=o.Origen,c=o.Serial,u=n[0];Paginas=15;var p=Math.ceil(s/15),g=s,f=new Array(g);for(v=0;v<=g;v++)for(f[v]=new Array(15),col=0;col<15;col++)0==col?f[v][col]=0==v?v:"title":f[v][col]=0==v?"title":"";var v=0;for(pagina=1;pagina<=p;pagina++){document.getElementById("txtArea2").innerHTML="pag "+pagina+"/"+p;var x=u+"?SID="+d+"&Origen="+l+"&Serial="+c+"&Reg="+s+"&Paginas="+Paginas+"&pagina="+pagina,f=calltoajaxpage(pagina,e,0,Paginas,s,p,d,l,c,x,0,f)}var b=setInterval(function(){var e=checkdatareg(f);if(console.log(e+" / "+s),e>=s){clearInterval(b);var t=document.getElementById("sql");t&&t.remove(),f=getpdf(f),bab=setInterval(function(){if(checkdata(f)>=s)return clearInterval(bab),clearInterval(b),clearInterval(m),console.log("Termino"),void savexlsdata(f)},3e3)}},5e3)}},5e3)}})},2e3)}function checkdata(e){var t=e.length,n=0;for(r=1;r<t;r++){var a=e[r][13];0==a||"0"==a||n++}return n}function checkdatareg(e){var t=e.length,n=0;for(rx=1;rx<t;rx++)e[rx][2]&&n++;return n}function calltoajaxpage(e,t,n,r,a,i,o,d,l,s,c,u){if(document.getElementById("rframe"+e));else postAjax(s,{SID:o,Origen:d,Serial:l,Reg:a,Paginas:r,pagina:e},function(t){if(document.getElementById("rframe"+e));else{var n=document.createElement("iframe");n.style.display="none",n.setAttribute("id","rframe"+e),document.body.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.write(t),n.contentWindow.document.close();i=n.contentWindow.document;document.body.removeChild(n);var r=i.getElementsByTagName("table"),i="";if(r.length>0&&(trx=r[6].getElementsByTagName("tr"),trx))for(els=0;els<trx.length;els++)if(0==els)if(document.getElementById("sorter"));else{for(document.createElement("tr").setAttribute("id","sorter"),tdso=trx[els].getElementsByTagName("td"),tso=0;tso<tdso.length;tso++)u[0][tso]=tdso[tso].innerHTML;u[0][12]="OBJETO",u[0][13]="DOCUMENTO",u[0][14]="OBSERVACIONES"}else if(1==els);else{els;var o=trx[els].getElementsByTagName("td");for(ts=0;ts<o.length;ts++)if(2!=ts){c=(s=o[ts].innerHTML.toString().replace(/(&nbsp;)/g,"")).replace(/<br\s*[\/]?>/g,"");if(0==ts){var d=parseInt(c);a<100&&d<10&&(c="0"+d.toString()),a>99&&a<1e3&&(d<10&&(c="00"+d.toString()),d>9&&d<100&&(c="0"+d.toString())),a>999&&a<1e4&&(d<10&&(c="000"+d.toString()),d>9&&d<100&&(c="00"+d.toString()),d>99&&d<1e3&&(c="0"+d.toString()))}var l=document.createElement("td");l.innerHTML=c,u[d][ts]=l.innerText}else{var s=o[ts].innerHTML.toString().replace(/(&nbsp;)/g,""),c=s.replace(/<br\s*[\/]?>/g,"");u[d][ts]=c}u[d][12]="0",u[d][13]="0",u[d][14]="0"}}});return u}function rockets(){var e=document.createElement("i");e.setAttribute("id","rocket"),e.setAttribute("class","fa fa-rocket fa-5x"),e.setAttribute("style","width:100%;text-align:center;padding:10px;color:#gray;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),e.setAttribute("aria-hidden","true");var t=document.getElementById("txtArea");t.innerHTML="";var n=document.createElement("p");n.innerHTML="iniciando busqueda",n.setAttribute("id","mess"),n.setAttribute("style","text-align:center;");var r=document.createElement("i");r.setAttribute("id","spin"),r.setAttribute("class","fa fa-cog fa-spin"),r.setAttribute("style","width:50px;text-align:center;margin-left:40px;color:#a3e853;font-size:60px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),r.setAttribute("aria-hidden","true");var a=document.createElement("i");a.setAttribute("id","spinf"),a.setAttribute("class","fa fa-cog fa-spin"),a.setAttribute("style","width:100px;text-align:center;padding:10px;color:white;font-size:40px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),a.setAttribute("aria-hidden","true");var i=document.createElement("i");i.setAttribute("id","spinfa"),i.setAttribute("class","fa fa-cog fa-spin"),i.setAttribute("style","width:25px;text-align:center;padding:10px;color:#ff5555;font-size:30px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),i.setAttribute("aria-hidden","true"),t.appendChild(e),t.appendChild(n),t.appendChild(r),t.appendChild(a),t.appendChild(i)}function cleanrock(){var e=document.getElementById("mess");e&&e.remove();var t=document.getElementById("spin");t&&t.remove();var n=document.getElementById("spinf");n&&n.remove();var r=document.getElementById("spinfa");r&&r.remove()}function getgraph(e){$("script").each(function(){"http://sil.gobernacion.gob.mx/Script/Calendario.js"===this.src&&this.parentNode.removeChild(this)});new Array;if(0==Validaentradas())return!1;document.getElementById("getgraph").remove(),rockets();var t=document.forms[0].LEGISLATURA.value,n=document.forms[0].CAMARA.value,r=document.forms[0].PRESENTADOR.value,a=document.MyForm.FECHA_INIC.value.split("/"),i=a[0]+"/"+a[1]+"/"+a[2],o=document.MyForm.FECHA_FIN.value.split("/"),d=o[0]+"/"+o[1]+"/"+o[2],l=setTimeout(function(){postAjax("http://sil.gobernacion.gob.mx/Numeralia/Asuntos/NumeraliaAsuntos.php",{LEGISLATURA:t,CAMARA:n,PRESENTADOR:r,FECHA_INIC:i,FECHA_FIN:d},function(e){var t=document.createElement("iframe");t.setAttribute("style","width:100%;height:350px"),t.setAttribute("id","gra"),document.body.appendChild(t),t.contentWindow.document,t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close();var n=t.contentWindow.document;if(n){var r=n.getElementsByTagName("script");for(els=0;els<r.length;els++)r[els].remove();var a=n.getElementsByTagName("table"),i=a[2].getElementsByTagName("tr");for(a[0].remove(),a[1].remove(),bo=n.getElementById("Botonera"),bo.remove(),cleanrock(),elstr=2;elstr<i.length;elstr++)for(trnd=i[elstr].getElementsByTagName("td"),elstd=0;elstd<trnd.length;elstd++){var o=trnd[elstd].getElementsByTagName("a")[0];if(o){var d=o.href;o.setAttribute("id","id-"+elstd),o.setAttribute("class","linkdata"),o.setAttribute("data-value",o.href),o.href="javascript:void(0)",crealink(o,d)}}clearTimeout(l)}})},1e3)}function crealink(e,t){e.addEventListener("click",function(e){rockets();t.split("?")[0];var n=t.split("?")[1].split("&");n[0].split("=")[1],n[1].split("=")[1],n[2].split("=")[1],n[3].split("=")[1],n[4].split("=")[1],n[5].split("=")[1],n[6].split("=")[1],calltoajax(t)})}function limpiar(){return txt=document.getElementById("txtArea"),txt2=document.getElementById("txtArea2"),txt3=document.getElementById("txtArea3"),txt4=document.getElementById("txtArea4"),lim=document.getElementById("limpiar"),gra=document.getElementById("gra"),gra&&gra.remove(),txt.remove(),txt2.remove(),txt3.remove(),txt4.remove(),lim.remove(),initvals(),!1}function initvals(){var e=document.createElement("div");e.setAttribute("id","limpiar"),e.setAttribute("style","text-align: center;padding:10px;");var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("class","blue"),t.setAttribute("onclick","limpiar();"),t.setAttribute("style","padding:5px;cursor:pointer;");r=document.createTextNode("Limpiar");t.appendChild(r),e.appendChild(t),document.body.appendChild(e);var n=document.createElement("button");n.setAttribute("id","getgraph"),n.setAttribute("type","button"),n.setAttribute("class","blue"),n.setAttribute("onclick","getgraph();"),n.setAttribute("style","padding:5px;cursor:pointer;");var r=document.createTextNode("Obtener datos de busqueda");n.appendChild(r);var a=document.createElement("div");a.setAttribute("id","txtArea"),a.setAttribute("style","text-align: center;padding:10px;color: #d8a139;margin: 0 auto;border:solid 1px; blue; background-color:#333333;display:block;width:auto;height:auto;");l="Presiona el boton Obtener datos y da click en seleccion que generara la tabla y posteriormente Exportar en excel<br/>";l+="Una vez procesado podras dar click en algun elemento de totales en la tabla para exportarlo<br/><br/>",a.innerHTML=l,a.appendChild(n),document.body.appendChild(a);var i=document.createElement("div");i.setAttribute("id","txtArea2"),i.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");l="";i.innerHTML=l,document.body.appendChild(i);var o=document.createElement("div");o.setAttribute("id","txtArea3"),o.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");l="";o.innerHTML=l,document.body.appendChild(o);var d=document.createElement("div");d.setAttribute("id","txtArea4"),d.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");var l="";d.innerHTML=l,document.body.appendChild(d)}var styler="font-size:18px;";styler+="height: 30px;",styler+="border: 1px solid #aaa;",styler+="border-radius: 5px;",$("script").each(function(){"http://www.google-analytics.com/ga.js"===this.src&&this.parentNode.removeChild(this),"http://sil.gobernacion.gob.mx/template/skin/jquery.ui.core.js"===this.src&&this.parentNode.removeChild(this)}),$("input").each(function(){"Continuar"===this.value&&this.parentNode.removeChild(this),"Limpiar"===this.value&&this.parentNode.removeChild(this),this.setAttribute("style",styler)}),$("select option").each(function(){this.parentNode.setAttribute("style",styler)});for(var links=new Array,i=document.body.attributes.length;i-- >0;)document.body.removeAttributeNode(document.body.attributes[i]);document.MyForm.setAttribute("action","");var jq=document.createElement("script");jq.src="//code.jquery.com/jquery-1.10.2.js",document.getElementsByTagName("head")[0].appendChild(jq),setTimeout(function(){jQuery.noConflict()},1e3);var fa=document.createElement("link");fa.href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",fa.setAttribute("type","text/css"),fa.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(fa),setTimeout(function(){jQuery.noConflict()},1e3);var fas=document.createElement("script");fas.src="//fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js",document.getElementsByTagName("head")[0].appendChild(fas),setTimeout(function(){jQuery.noConflict()},1e3);var contaj=0,start=new Date;initvals(),document.body.setAttribute("style","background-color:cadetblue");
