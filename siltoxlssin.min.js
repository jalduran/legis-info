function postAjax(e,t,n){var r="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){if(a.readyState>3&&200==a.status){contaj++;var e=new Date;document.getElementById("txtArea4").innerHTML="procesados: "+contaj+" Tiempo: "+returnDiffToText(e-start),n(a.responseText)}},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(r),a}function returnDiffToText(e){var t="";if((e=e/1e3)<60)t=e+" segundos";else{var n=Math.round(e%60);e=Math.floor(e/60);var r=Math.round(e%60);e=Math.floor(e/60);var a=Math.round(e%24);e=Math.floor(e/24);t=e>0?e+" dias, "+a+" horas, "+r+" minutos y "+n+" segundos":a>0?a+" horas, "+r+" minutos y "+n+" segundos":r+" minutos y "+n+" segundos"}return t}function Validaentradas(){var intLegislatura=document.forms[0].LEGISLATURA.selectedIndex,intCamara=document.forms[0].CAMARA.selectedIndex,intActor=document.forms[0].PRESENTADOR.selectedIndex,FECHA_INIC=document.MyForm.FECHA_INIC.value,FECHA_FIN=document.MyForm.FECHA_FIN.value;with(document.MyForm){if(0==intLegislatura)return alert("Selecciona una legislatura"),document.forms[0].LEGISLATURA.focus(),!1;if(0==intCamara)return alert("Selecciona una instancia"),document.forms[0].CAMARA.focus(),!1;if(0==intActor)return alert("Selecciona una opción de los presentadores"),document.forms[0].PRESENTADOR.focus(),!1;if(""==document.MyForm.FECHA_INIC.value&&""!=document.MyForm.FECHA_FIN.value)return alert("Debes incluir la fecha de inicio para poder realizar la búsqueda"),document.MyForm.FECHA_INIC.focus(),!1;if(ValidateDates("MyForm","FECHA_INIC","FECHA_FIN"))return intLegislatura=document.MyForm.LEGISLATURA.options[document.MyForm.LEGISLATURA.selectedIndex].value,!!ValidaFechasFormulario("MyForm","FECHA_INIC","FECHA_FIN",intLegislatura,"mensaje")}return!0}function savexlsdata(e){for(var t=window.setInterval("",5e3),n=1;n<t;n++)window.clearInterval(n);for(t=window.setInterval("",2e3),n=1;n<t;n++)window.clearInterval(n);var r="",a="<tr>";for(j=0;j<e.length;j++){a="<tr>";var o=e[j];for(c=0;c<o.length;c++)a=a+"<td>"+o[c]+"</td>";r+=a+="</tr>"}var i=new Blob(['<meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><table border="1">'+r+"</table>"],{type:"data:application/vnd.ms-excel;charset=UTF-8"}),d=document.getElementById("filename").value;saveAs(i,"sil_"+d+".xls"),document.getElementById("txtArea3").innerHTML=parseInt(r.length/1e3)+" Kb";e=new Array;cleanrock(),document.getElementById("rocket").setAttribute("style","text-align:center;color:#49ca4e;")}function calltoajax(e){if(e){e.split("?")[0];var t=e.split("?")[1].split("&"),n=t[0].split("=")[1],r=t[1].split("=")[1],a=t[2].split("=")[1],o=t[3].split("=")[1],d=t[4].split("=")[1],s=t[5].split("=")[1],l=t[6].split("=")[1],c=t.join("-");c.replace("=","_");var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("id","filename"),u.setAttribute("name","filename"),u.setAttribute("value",c),document.body.appendChild(u)}var m=setInterval(function(){postAjax(e,{Clave:n,Legislatura:r,Camara:a,Actor:o,FechI:d,FechF:s,Reg:l},function(e){var t=document.createElement("iframe");t.setAttribute("style","width:100%;height:350px"),t.style.display="none",t.setAttribute("id","rframex"),document.body.appendChild(t),t.contentWindow.document,t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close();var n=t.contentWindow.document;if((links=n.getElementsByTagName("a")).length>0){clearInterval(m);var r=document.createElement("input");r.setAttribute("id","sql"),r.setAttribute("name","sql"),r.setAttribute("type","hidden"),r.setAttribute("value",links[0].href),document.body.appendChild(r);var a=setTimeout(function(){var e=document.getElementById("sql");if(e){var t;if(clearTimeout(a),t=document.getElementsByTagName("iframe"))for(inn=1;inn<t.length;inn++)t[inn].remove();(t=document.getElementById("rframex"))&&t.remove();var n=e.value.split("?"),r=n[1].split("&"),o=new Array;for(i=0;i<r.length;i++)o[r[i].split("=")[0]]=r[i].split("=")[1];var d=o.SID,s=o.Origen,c=o.Serial,u=n[0];Paginas=15;var p=Math.ceil(l/15),g=l,x=new Array(g);for(f=0;f<=g;f++)for(x[f]=new Array(12),col=0;col<12;col++)0==col?x[f][col]=0==f?f:"title":x[f][col]=0==f?"title":"";var f=0;for(pagina=1;pagina<=p;pagina++){document.getElementById("txtArea2").innerHTML="pag "+pagina+"/"+p;var v=u+"?SID="+d+"&Origen="+s+"&Serial="+c+"&Reg="+l+"&Paginas="+Paginas+"&pagina="+pagina;x=calltoajaxpage(pagina,e,0,Paginas,l,p,d,s,c,v,0,x)}var b=setInterval(function(){var e=checkdatareg(x);if(console.log(e+" / "+l),e>=l){clearInterval(b);var t=document.getElementById("sql");return t&&t.remove(),clearInterval(b),clearInterval(m),console.log("Termino"),void savexlsdata(x)}},5e3)}},5e3)}})},2e3)}function checkdatareg(e){var t=e.length,n=0;for(rx=1;rx<t;rx++){e[rx][2]&&n++}return n}function calltoajaxpage(e,t,n,r,a,o,i,d,s,l,c,u){if(document.getElementById("rframe"+e));else postAjax(l,{SID:i,Origen:d,Serial:s,Reg:a,Paginas:r,pagina:e},function(t){if(document.getElementById("rframe"+e));else{var n=document.createElement("iframe");n.style.display="none",n.setAttribute("id","rframe"+e),document.body.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.write(t),n.contentWindow.document.close();var r=n.contentWindow.document;document.body.removeChild(n);var o=r.getElementsByTagName("table");r="";if(o.length>0&&(trx=o[6].getElementsByTagName("tr"),trx))for(els=0;els<trx.length;els++){if(0==els)if(document.getElementById("sorter"));else for(document.createElement("tr").setAttribute("id","sorter"),tdso=trx[els].getElementsByTagName("td"),tso=0;tso<tdso.length;tso++)u[0][tso]=tdso[tso].innerHTML;else if(1==els);else{els;var i=trx[els].getElementsByTagName("td");for(ts=0;ts<i.length;ts++){var d=i[ts].innerHTML.toString().replace(/(&nbsp;)/g,"").replace(/<br\s*[\/]?>/g,"");if(0==ts){var s=parseInt(d);a<100&&s<10&&(d="0"+s.toString()),a>99&&a<1e3&&(s<10&&(d="00"+s.toString()),s>9&&s<100&&(d="0"+s.toString())),a>999&&a<1e4&&(s<10&&(d="000"+s.toString()),s>9&&s<100&&(d="00"+s.toString()),s>99&&s<1e3&&(d="0"+s.toString()))}var l=document.createElement("td");l.innerHTML=d,u[s][ts]=l.innerText}}}}});return u}function rockets(){var e=document.createElement("i");e.setAttribute("id","rocket"),e.setAttribute("class","fa fa-rocket fa-5x"),e.setAttribute("style","width:100%;text-align:center;padding:10px;color:#gray;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),e.setAttribute("aria-hidden","true");var t=document.getElementById("txtArea");t.innerHTML="";var n=document.createElement("p");n.innerHTML="iniciando busqueda",n.setAttribute("id","mess"),n.setAttribute("style","text-align:center;");var r=document.createElement("i");r.setAttribute("id","spin"),r.setAttribute("class","fa fa-cog fa-spin"),r.setAttribute("style","width:50px;text-align:center;margin-left:40px;color:#a3e853;font-size:60px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),r.setAttribute("aria-hidden","true");var a=document.createElement("i");a.setAttribute("id","spinf"),a.setAttribute("class","fa fa-cog fa-spin"),a.setAttribute("style","width:100px;text-align:center;padding:10px;color:white;font-size:40px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),a.setAttribute("aria-hidden","true");var o=document.createElement("i");o.setAttribute("id","spinfa"),o.setAttribute("class","fa fa-cog fa-spin"),o.setAttribute("style","width:25px;text-align:center;padding:10px;color:#ff5555;font-size:30px;text-shadow: 2px 0 0 #6d6d6d, -2px 0 0 #6d6d6d, 0 2px 0 #6d6d6d, 0 -2px 0 #6d6d6d, 1px 1px #6d6d6d, -1px -1px 0 #6d6d6d, 1px -1px 0 #6d6d6d, -1px 1px 0 #6d6d6d;"),o.setAttribute("aria-hidden","true"),t.appendChild(e),t.appendChild(n),t.appendChild(r),t.appendChild(a),t.appendChild(o)}function cleanrock(){var e=document.getElementById("mess");e&&e.remove();var t=document.getElementById("spin");t&&t.remove();var n=document.getElementById("spinf");n&&n.remove();var r=document.getElementById("spinfa");r&&r.remove()}function getgraph(e){$("script").each(function(){"http://sil.gobernacion.gob.mx/Script/Calendario.js"===this.src&&this.parentNode.removeChild(this)});new Array;if(0==Validaentradas())return!1;document.getElementById("getgraph").remove(),rockets();var t=document.forms[0].LEGISLATURA.value,n=document.forms[0].CAMARA.value,r=document.forms[0].PRESENTADOR.value,a=document.MyForm.FECHA_INIC.value.split("/"),o=a[0]+"/"+a[1]+"/"+a[2],i=document.MyForm.FECHA_FIN.value.split("/"),d=i[0]+"/"+i[1]+"/"+i[2],s=setTimeout(function(){postAjax("http://sil.gobernacion.gob.mx/Numeralia/Asuntos/NumeraliaAsuntos.php",{LEGISLATURA:t,CAMARA:n,PRESENTADOR:r,FECHA_INIC:o,FECHA_FIN:d},function(e){var t=document.createElement("iframe");t.setAttribute("style","width:100%;height:350px"),t.setAttribute("id","gra"),document.body.appendChild(t),t.contentWindow.document,t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close();var n=t.contentWindow.document;if(n){var r=n.getElementsByTagName("script");for(els=0;els<r.length;els++)r[els].remove();var a=n.getElementsByTagName("table"),o=a[2].getElementsByTagName("tr");for(a[0].remove(),a[1].remove(),bo=n.getElementById("Botonera"),bo.remove(),cleanrock(),elstr=2;elstr<o.length;elstr++)for(trnd=o[elstr].getElementsByTagName("td"),elstd=0;elstd<trnd.length;elstd++){var i=trnd[elstd].getElementsByTagName("a")[0];if(i){var d=i.href;i.setAttribute("id","id-"+elstd),i.setAttribute("class","linkdata"),i.setAttribute("data-value",i.href),i.href="javascript:void(0)",crealink(i,d)}}clearTimeout(s)}})},1e3)}function crealink(e,t){e.addEventListener("click",function(e){rockets();t.split("?")[0];var n=t.split("?")[1].split("&");n[0].split("=")[1],n[1].split("=")[1],n[2].split("=")[1],n[3].split("=")[1],n[4].split("=")[1],n[5].split("=")[1],n[6].split("=")[1],calltoajax(t)})}function limpiar(){return txt=document.getElementById("txtArea"),txt2=document.getElementById("txtArea2"),txt3=document.getElementById("txtArea3"),txt4=document.getElementById("txtArea4"),lim=document.getElementById("limpiar"),gra=document.getElementById("gra"),gra&&gra.remove(),txt.remove(),txt2.remove(),txt3.remove(),txt4.remove(),lim.remove(),initvals(),!1}function initvals(){var e=document.createElement("div");e.setAttribute("id","limpiar"),e.setAttribute("style","text-align: center;padding:10px;");var t=document.createElement("button");t.setAttribute("type","button"),t.setAttribute("class","blue"),t.setAttribute("onclick","limpiar();"),t.setAttribute("style","padding:5px;cursor:pointer;");var n=document.createTextNode("Limpiar");t.appendChild(n),e.appendChild(t),document.body.appendChild(e);var r=document.createElement("button");r.setAttribute("id","getgraph"),r.setAttribute("type","button"),r.setAttribute("class","blue"),r.setAttribute("onclick","getgraph();"),r.setAttribute("style","padding:5px;cursor:pointer;");n=document.createTextNode("Obtener datos de busqueda");r.appendChild(n);var a=document.createElement("div");a.setAttribute("id","txtArea"),a.setAttribute("style","text-align: center;padding:10px;color: #d8a139;margin: 0 auto;border:solid 1px; blue; background-color:#333333;display:block;width:auto;height:auto;");var o="Presiona el boton Obtener datos y da click en seleccion que generara la tabla y posteriormente Exportar en excel<br/>";o+="Una vez procesado podras dar click en algun elemento de totales en la tabla para exportarlo<br/><br/>",a.innerHTML=o,a.appendChild(r),document.body.appendChild(a);var i=document.createElement("div");i.setAttribute("id","txtArea2"),i.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");o="";i.innerHTML=o,document.body.appendChild(i);var d=document.createElement("div");d.setAttribute("id","txtArea3"),d.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");o="";d.innerHTML=o,document.body.appendChild(d);var s=document.createElement("div");s.setAttribute("id","txtArea4"),s.setAttribute("style","text-align: left;padding:10px;color: #5db500;margin: 0 auto;border:solid 1px; blue; background-color:#000000;display:block;width:auto;height:auto;");o="";s.innerHTML=o,document.body.appendChild(s)}var styler="font-size:18px;";styler+="height: 30px;",styler+="border: 1px solid #aaa;",styler+="border-radius: 5px;",$("script").each(function(){"http://www.google-analytics.com/ga.js"===this.src&&this.parentNode.removeChild(this),"http://sil.gobernacion.gob.mx/template/skin/jquery.ui.core.js"===this.src&&this.parentNode.removeChild(this)}),$("input").each(function(){"Continuar"===this.value&&this.parentNode.removeChild(this),"Limpiar"===this.value&&this.parentNode.removeChild(this),this.setAttribute("style",styler)}),$("select option").each(function(){this.parentNode.setAttribute("style",styler)});for(var links=new Array,i=document.body.attributes.length;i-- >0;)document.body.removeAttributeNode(document.body.attributes[i]);document.MyForm.setAttribute("action","");var jq=document.createElement("script");jq.src="//code.jquery.com/jquery-1.10.2.js",document.getElementsByTagName("head")[0].appendChild(jq),setTimeout(function(){jQuery.noConflict()},1e3);var fa=document.createElement("link");fa.href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",fa.setAttribute("type","text/css"),fa.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(fa),setTimeout(function(){jQuery.noConflict()},1e3);var fas=document.createElement("script");fas.src="//fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js",document.getElementsByTagName("head")[0].appendChild(fas),setTimeout(function(){jQuery.noConflict()},1e3);var contaj=0,start=new Date;initvals(),document.body.setAttribute("style","background-color:cadetblue");
