function postAjax(e,t,n){var r="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open("POST",e),a.onreadystatechange=function(){a.readyState>3&&200==a.status&&n(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(r),a}function postajaxvot(t,n,r,a,o,d,l){postAjax("http://"+t+n,{evento:a,nomtit:o,[r.name]:r.value},function(t){var n=document.getElementById("vtvotes"),a=[],l=[],s=0,c=str2DOMElement(t),m=0,u=new Array,p=document.getElementById("frmArea"),g=p.getElementsByTagName("tr")[1].getElementsByTagName("b"),b=p.getElementsByTagName("tr");for(e=2;e<b.length;e++){var f=b[e].getElementsByTagName("td").length;f>2&&(lt=f,u[m]=b[e].getElementsByTagName("font")[0].innerText,m++)}for(i=0;i<c.parentNode.childNodes.length;i++){if("TABLE"==(y=c.parentNode.childNodes[i].nodeName)){if(c.parentNode.childNodes[i].getElementsByTagName("table").length>0)for(nn=2;nn<c.parentNode.childNodes[i].getElementsByTagName("table")[1].getElementsByTagName("td").length;nn++){l=c.parentNode.childNodes[i].getElementsByTagName("table")[1].getElementsByTagName("td")[nn].childNodes;for(ix=0;ix<l.length;ix++)l[ix].data&&(a[s]=l[ix].data.split(":")[1],s++)}else for(nn=0;nn<c.parentNode.childNodes[i].getElementsByTagName("td").length;nn++){l=c.parentNode.childNodes[i].getElementsByTagName("td")[nn].childNodes;for(ix=0;ix<l.length;ix++)l[ix].data&&(a[s]=l[ix].data.split(":")[1],s++)}var x=document.createElement("table");x.setAttribute("id","vt"+r.name),x.setAttribute("align","center"),x.setAttribute("border",""),x.setAttribute("cellspacing","2"),x.setAttribute("width","600"),x.setAttribute("class","result"),x.setAttribute("style","display:none;");var y=getname(r.name,g,u,f),v=o.split("<p>")[0],h=o.split("<p>")[1].replace("de","/"),T=(h=(h=h.replace("de","/")).replace(" ","")).split("/");console.log(T);var A=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"].indexOf(T[1].trim())+1,E=T[0].trim();if(A<10&&(A="0"+A),E<10&&(E="0"+E),h=E+"/"+A+"/"+T[2].trim(),console.log(h),""==y.partido||null==y.partido);else{0;var N='<tbody><tr class="votr"><td bgcolor="'+d+'">Legislador</td>';N+="<td>Partido</td>",N+="<td>Tipo</td>",N+="<td>Fecha</td>",N+="<td>Asunto</td>",N+="</tr>";var B=document.createElement("tr");for(ix=0;ix<a.length;ix++){B=document.createElement("tr");N+="<tr><td>"+a[ix]+"</td>",N+="<td>"+y.partido+"</td>";var w="<td>"+a[ix]+"</td>";w+="<td>"+y.partido+"</td>",N+="<td>"+y.tipo+"</td>",N+="<td>"+h+"</td>",N+="<td>"+v+"</td>",w+="<td>"+y.tipo+"</td>",w+="<td>"+h+"</td>",w+="<td>"+v+"</td>",N+="</tr>",B.innerHTML=w,n.appendChild(B),0}N+="</tbody>",x.innerHTML=N,document.body.appendChild(x)}}}})}function savexls(e){var t="<table border='2px'><tr bgcolor='#87AFC6'>",n=0;for(tab=document.getElementById("vt"+e),n=0;n<tab.rows.length;n++)t=t+tab.rows[n].innerHTML+"</tr>";t+="</table>",window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?(txtArea.document.open("txt/html","replace"),txtArea.document.write(t),txtArea.document.close(),txtArea.focus(),sa=txtArea.document.execCommand("SaveAs",!0,e)):sa=window.open("data:application/vnd.ms-excel,"+escape(t))}function getname(e,t,n,r){var a=new Array;a.partido="",a.tipo="",a.cn=0;var o=parseInt(e.match(/\[(.*?)\]/)[1]);for(f=2;f<=lt;f++)o>10*f&&o<10*f+11&&(a.partido=t[f].innerText,a.tipo=n[o-(10*f+1)],a.cn=f);return a}function sort(t){var n=new Array,r=document.getElementById("vtvotes").getElementsByTagName("tr");for(e=1;e<r.length;e++){var a=r[e].getElementsByTagName("td");n.push([a[0].innerText,a[1].innerText,a[2].innerText,a[3].innerText,a[4].innerText])}switch(t){case"p":n.sort(function(e,t){return(e=e[1]+e[2]+e[0])==(t=t[1]+t[2]+t[0])?0:e<t?-1:1});break;case"t":n.sort(function(e,t){return(e=e[2]+e[1]+e[0])==(t=t[2]+t[1]+t[0])?0:e<t?-1:1})}for(e=1;e<r.length;e++){(a=r[e].getElementsByTagName("td"))[0].innerText=n[e-1][0],a[1].innerText=n[e-1][1],a[2].innerText=n[e-1][2],a[3].innerText=n[e-1][3],a[4].innerText=n[e-1][4]}}function fnExcelReport(){var t=document.createElement("table");t.setAttribute("id","vtvotes"),t.setAttribute("align","center"),t.setAttribute("border",""),t.setAttribute("width","610");var n=window.location.hostname,r=0,a=0,o=document.getElementsByTagName("form");o[0].setAttribute("id","frmArea");var d=document.getElementById("frmArea").getAttribute("action"),i=new Array,l=((b=document.getElementById("frmArea")).getElementsByTagName("tr")[1].getElementsByTagName("b"),b.getElementsByTagName("tr"));for(e=2;e<l.length;e++){var s=l[e].getElementsByTagName("td").length;s>2&&(lt=s,i[r]=l[e].getElementsByTagName("font")[0].innerText,r++)}var c=o[0].elements;for(e=0;e<c.length;e++){if("undefined"!==c[e].name)if(c[e].name.length){if("evento"==c[e].name){c[e].name;var m=c[e].value}if("nomtit"==c[e].name){c[e].name;var u=c[e].value}if("nomtit"!=c[e].name&&"evento"!=c[e].name&&" 0 "!=c[e].value){if(1==++a){"<td>Partido</td>","<td>Tipo</td>","<td>Fecha</td>","<td>Asunto</td>","</tr>",t.innerHTML="<tr><td>Legislador</td><td>Partido</td><td>Tipo</td><td>Fecha</td><td>Asunto</td></tr>",document.body.appendChild(t)}var p="#"+((1<<24)*Math.random()|0).toString(16);c[e].style.backgroundColor=p,c[e].style.cursor="pointer",c[e].type="button",c[e].setAttribute("onclick",'savexls("'+c[e].name+'");'),postajaxvot(n,d,c[e],m,u,p,e)}}else c[e].style.backgroundColor="#ffbcbc";var g=document.getElementById("btnExport");g.setAttribute("onclick",""),g.setAttribute("style","display:none;")}var b=document.getElementById("txtArea"),f=document.createElement("button"),x=(document.createElement("button"),document.createElement("button")),y=document.createElement("button");f.setAttribute("onclick",'savexls("votes");'),x.setAttribute("onclick",'sort("p");'),y.setAttribute("onclick",'sort("t");'),f.setAttribute("style","padding:5px;cursor:pointer;"),x.setAttribute("style","padding:5px;cursor:pointer;"),y.setAttribute("style","padding:5px;cursor:pointer;");var v=document.createTextNode("Exportar Excel"),h=document.createTextNode("Ordenar por partido"),T=document.createTextNode("Ordenar por tipo");f.appendChild(v),x.appendChild(h),y.appendChild(T),b.appendChild(f),b.appendChild(x),b.appendChild(y)}var jq=document.createElement("script");jq.src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(jq),setTimeout(function(){jQuery.noConflict(),console.log("jQuery loaded")},1e3);var btn=document.createElement("button");btn.setAttribute("id","btnExport"),btn.setAttribute("onclick","fnExcelReport();"),btn.setAttribute("style","padding:5px;cursor:pointer;");var t=document.createTextNode("Procesa datos");btn.appendChild(t);var ifr=document.createElement("div");ifr.setAttribute("id","txtArea"),ifr.setAttribute("style","margin: 0 auto;border:solid 1px; blue; background-color:#e4e4e4;display:block;width:600px;height:120px;overflow:scroll;");var help="Presiona el boton procesar que generara la tabla y posteriormente Exportar en excel<br/>";help+="Una vez procesado podras dar click en algun elemento de totales en la tabla de votaciones para exportarlo<br/><br/>",ifr.innerHTML=help,ifr.appendChild(btn),document.body.appendChild(ifr);var str2DOMElement=function(e){var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),t.contentDocument.close();var n=t.contentDocument.body.firstChild;return document.body.removeChild(t),n};
